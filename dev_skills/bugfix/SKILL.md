---
name: bugfix
description: 诊断并修复 Midas 缺陷或回归。用于接口报错、流程异常、测试失败、行为与预期不一致等问题。
---

# Bugfix（缺陷修复）

## 必须流程
1. 明确复现步骤（输入、命令、期望、实际）。
2. 记录失败签名（报错、日志位置、接口返回）。
3. 定位根因（文件 + 函数/类）。
4. 给最小修复方案并实施。
5. 补回归测试，覆盖本次失败路径。
6. 运行测试确认失败签名消失。
7. 更新相关文档并提交。

## 评分/召回/推荐类问题（强制流程）
- 适用范围：候选为空、候选过多、误报高、漏报高、排序不合理。
1. 先抽取真实数据全集（当前库），输出样本与特征分布。
2. 先做人审基线：给出“应命中对/不应命中对”对照集（至少 10 对正样本，若样本不足需在交付中说明）。
3. 跑程序全量打分并与人审对比，输出 Precision、Recall、TopK 命中。
4. 仅在对比报告基础上调权重/阈值，不允许凭直觉调参。
5. 调参后必须复跑同一对照集，展示前后指标变化。
6. 为本次缺陷补回归测试，至少锁定 1 个“此前漏检”的正样本。
7. 交付必须包含：样本清单、阈值选择理由、残余误报风险。

硬约束：
- 未提供“人审 vs 程序”对照结果，不得结束任务。
- 仅改阈值且无特征解释时，不得提交。

## 事故复盘要求（涉及数据风险时强制）
- 当问题触及“数据丢失/数据不可见/配置回滚”时，修复之外必须输出复盘，包含：
1. 影响面：影响了哪些数据、用户可见症状。
2. 时间线：至少写明触发时间与关键操作（绝对日期）。
3. 根因链路：触发条件 -> 代码/脚本 -> 最终表现。
4. 证据：日志、命令输出、文件路径、配置快照。
5. 防再发：最小可执行动作（代码、脚本、文档、告警）。

## Midas 约束
- 任何修复都要保持错误码契约稳定。
- 对外报错必须可读，禁止抛裸异常给客户端。
- 涉及配置问题的修复需同步更新示例配置与 README。
- 涉及数据或清理逻辑时，默认不得删除/覆盖 `server/.tmp/backups/` 下的 `.db` 备份文件（含 `*_latest.db`）；如必须删除需用户明确授权。

## 输出内容
- 根因摘要
- 修复点清单
- 测试结果
- 残余风险
