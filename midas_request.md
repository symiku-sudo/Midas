# 产品需求文档：个人多模态知识库助手 Midas (High-Accuracy MVP)

## 1. 项目概述

开发一套 **Client-Server 架构** 的个人知识库系统。

- **服务端**：部署在具备 **本地 GPU** 的 PC 上，作为核心算力中心，负责音视频处理与 AI 推理。
- **客户端**：运行于 **Android** 设备，作为轻量级交互界面，用于发送指令和查看结果。
- **核心目标**：**准确性优先**，而非速度优先。需确保音频转录精准，且小红书同步过程安全（防封号）。

---

## 2. 约束与前提

### 2.1 运行环境

- 服务端与客户端之间通过 **局域网** 通信；不要求公网暴露。
- 小红书鉴权采用 **用户手动提供 Cookie** 的方式（如从浏览器复制），由服务端配置使用；不在客户端存储或传输 Cookie 明文。

### 2.2 依赖与前置条件

- 服务端需能访问：B 站视频资源（用于获取音频）、所选用的 LLM 接口、小红书网页端接口。
- 用户需自行准备：有效的 LLM API 凭证、小红书登录态（Cookie）及目标收藏夹标识。

---

## 3. 服务端功能需求

### 3.1 B 站视频总结（精度优先）

- **输入**：接收客户端提交的 B 站视频链接。
- **行为要求**：
  - 获取该视频的 **高质量音频**，并完成 **语音转文字**。转写需在 **本地 GPU** 上执行，并 **优先保证识别准确率**（允许以更长耗时换取更高准确度）。
  - 将转写文本交由 **外部 LLM** 生成 **结构清晰的 Markdown 笔记**，并返回给客户端。
- **输出**：向客户端返回可展示的 Markdown 总结内容；失败时返回可理解的错误信息。

### 3.2 小红书收藏夹同步（风控与安全）

- **输入**：接收客户端的「同步」请求。
- **配置依赖**：依赖本地配置中的小红书 Cookie 与目标收藏夹标识。
- **行为要求（风控与安全）**：
  1. **数量限制**：单次同步 **仅拉取有限条数** 的最近笔记（具体上限由实现决定），避免全量扫描引发风控。
  2. **增量去重**：服务端需 **持久化已同步笔记标识**，仅处理未同步过的新笔记。
  3. **请求节奏**：在连续处理多条新笔记时，**在请求之间加入随机、人性化的间隔**，降低被识别为脚本的风险。
  4. **异常熔断**：若在同步过程中 **连续多次** 出现请求失败（如接口限流、鉴权失效），应 **立即停止本次同步**，并记录错误信息，避免对账号造成进一步风险。
  5. **内容处理**：对每条新笔记提取正文，调用 LLM 生成总结，并将成功处理过的笔记标识落库。
- **输出**：返回本次新增笔记的总结列表；若因熔断或配置问题终止，需返回明确、可区分的错误提示，便于用户排查（如 Cookie 失效）。

### 3.3 配置与可运维性

- 服务端需支持通过 **配置文件或等价方式** 指定：服务监听地址与端口、LLM 相关参数（如 API 地址、模型、凭证）、ASR/语音转写相关参数、小红书 Cookie 与收藏夹标识。
- 关键错误（如熔断、鉴权失败）应有 **日志或可追溯记录**，便于用户自查。

---

## 4. 客户端功能需求

### 4.1 连接与设置

- 用户可 **配置服务端地址与端口**（如 IP + 端口）。
- 提供 **连接测试** 能力，使用户能确认当前配置下能否访问服务端。

### 4.2 B 站总结

- 提供 **输入框与提交入口**，用于输入 B 站视频链接并发起总结请求。
- 因转写与总结可能耗时较长，需在请求进行中给出 **明确的等待/加载状态**，避免用户误以为无响应。
- 成功时在 **结果展示区** 呈现返回的 Markdown 内容；失败时给出 **可理解的错误提示**。

### 4.3 小红书同步

- 提供 **单一入口**（如「同步最近收藏」按钮）触发一次同步。
- 同步过程中需展示 **进度反馈**（如当前处理到第几条、共几条），并在服务端返回熔断或鉴权类错误时，给出 **明确提示**（如提示用户检查 Cookie 或服务端日志）。

### 4.4 结果展示

- 具备 **Markdown 渲染** 能力，能正确展示标题、列表、代码块等常见 Markdown 结构，用于呈现 B 站总结与小红书笔记总结。

---

## 5. 非功能需求

- **可接受耗时**：B 站总结允许在「分钟级」完成，客户端与文案上应引导用户预期为「高精度处理，请耐心等待」。
- **错误可感知**：网络异常、服务端错误、熔断、Cookie 失效等，应在客户端有明确反馈，不静默失败。
- **安全与隐私**：小红书 Cookie 仅存于用户可控的服务端环境，不在客户端持久化或经公网传输；整体使用场景限定在用户自有局域网内。

---

## 6. 验收场景（示例）

以下为典型验收场景，用于确认需求是否满足；实现方式不限。

| 场景 | 预期 |
|------|------|
| B 站总结：提交有效链接 | 最终在结果区看到结构清晰的 Markdown 总结；过程中有加载状态。 |
| B 站总结：链接无效或服务异常 | 用户收到明确错误提示，而非一直 loading 或空白。 |
| 小红书同步：正常执行 | 仅新笔记被拉取并总结，结果列表正确；有进度反馈。 |
| 小红书同步：Cookie 失效或触发熔断 | 同步停止，用户看到与「Cookie/限流」相关的提示，并能在服务端查到错误记录。 |
| 连接测试：配置正确 | 测试通过，用户可继续使用。 |
| 连接测试：配置错误或服务未启动 | 测试失败，有清晰提示。 |

---

*本文档仅描述产品需求与约束，具体技术选型与实现细节由实现方在满足上述需求的前提下自行决定。*
